# 单位系统设计

> **文档版本**: v0.4
> **最后更新**: 2026-01-19
> **状态**: 文档统一修改完成，补充召唤规模机制

---

## 1. 单位属性系统

### 1.1 单位模式分类（6种）

| 模式 | 定位 | 核心特征 |
|------|------|----------|
| **肉盾型** | 前排承伤 | 极高HP，低伤害，吸引火力 |
| **战士型** | 中排输出 | 均衡属性，稳定输出 |
| **刺客型** | 爆发突进 | 高伤害，低HP，切后排 |
| **法师型** | AOE远程 | 低HP，高AOE伤害 |
| **辅助型** | 增益/控制 | 治疗/增益/控制效果 |
| **建筑型** | 固定防御 | 无法移动，阵地守卫 |

### 1.2 单位词条系统（多标签组合）

| 词条类型 | 标签选项 | 说明 |
|----------|----------|------|
| **元素词条** | 地/风/水/火/草/金/冰/通用 | 决定与地块的交互 |
| **攻击类型** | 近战/远程/魔法 | 决定攻击方式 |
| **被动效果** | 暴怒/吸血/闪避/护盾/反击/再生/... | 触发型被动技能 |
| **移动类型** | 地面/飞行/潜行 | 决定移动规则 |
| **特殊词条** | 不朽/分裂/自爆/... | 独特机制 |

**元素词条说明**（8种）：
- **地**：对应农田、沙地
- **风**：机动性相关，暂无对应地块
- **水**：对应水域、沼泽
- **火**：对应熔岩
- **草**：对应草地、森林
- **金**：对应岩石
- **冰**：对应冰原
- **通用**：无对应地块，无明显加成减益

> 详细交互规则见 [06_地形系统_完整](./06_地形系统_完整.md)

**词条示例**：
- **暴怒**：生命值低于30%时，攻击力+50%，攻速+30%
- **吸血**：造成伤害的30%回复自身生命
- **闪避**：有20%几率完全规避单次攻击
- **反击**：受到近战攻击时，反弹50%伤害
- **分裂**：死亡时分裂为2个 weakened 版本

### 1.3 召唤消耗

| 属性 | 说明 |
|------|------|
| **法力消耗** | 0-10点（皇室战争式） |
| **地块需求** | 固定消耗1块对应地形地块 |

### 1.4 召唤规模

每次召唤生成的单位数量不限于1个，部分单位以**小组形式**出现：

| 规模 | 说明 | 示例 |
|------|------|------|
| **单体** | 消耗1地块，生成1个单位 | 大部分肉盾型、战士型、刺客型 |
| **双人小组** | 消耗1地块，生成2个单位 | 游侠双人组、沙虫双子 |
| **三人小组** | 消耗1地块，生成3个单位 | 精灵三人众、史莱姆分裂体 |

**设计原则**：

- 小组单位整体属性略低于同成本的独立单位
- 小组单位生命条各自独立但总数较低
- 小队成员死亡后数量减少，不影响剩余成员行动

### 1.5 单位词条与地块交互

| 亲和档位 | 加成效果 | 判定条件 |
|----------|----------|----------|
| 极大优势 | +50% 全属性 | 单位词条与地块完全匹配的特殊情况 |
| 主场优势 | +20% 全属性 | 单位词条对应的地块 |
| 友好环境 | +10% 全属性 | 单位词条与地块相容 |
| 中立 | 0 | 无加成减益 |
| 轻微不利 | -10% 全属性 | 单位词条与地块不兼容 |
| 明显不利 | -20% 全属性 | 单位词条与地块对立 |
| 极端克制 | -50% 全属性 | 单位词条与地块严重冲突（如火词条在水域） |

> **伤害效果独立计算**：地形特殊效果（灼烧/溺水/冻结/困住等）的伤害单独计算，不在属性加成档位中。
>
> **详细交互矩阵**：见 [06_地形系统_完整](./06_地形系统_完整.md)

---

## 2. 单位分类（按地形）

**9种地形 × 每种3种单位 = 27种基础单位**

| 地形 | 特性主题 | 单位1 | 单位2 | 单位3 |
|------|----------|-------|-------|-------|
| **水域** | 流动/治疗/控制 | 潮汐卫士 | 激流射手 | 海妖 |
| **沙漠** | 视野/耗竭/埋伏 | 沙虫 | 沙行者 | 绿洲灵 |
| **岩石** | 防御/坚固/阻挡 | 山岳巨人 | 投石车 | 石墙塔 |
| **草地** | 均衡/通用/灵活 | 草原骑兵 | 游侠 | 牧师 |
| **森林** | 隐蔽/闪避/生长 | 远古树人 | 精灵刺客 | 德鲁伊 |
| **农田** | 经济/产出/补给 | 麦田傀儡 | 农夫战士 | 丰收之灵 |
| **熔岩** | 伤害/灼烧/爆发 | 熔岩巨像 | 火元素 | 烈焰术士 |
| **沼泽** | 中毒/减速/控制 | 毒藤巨怪 | 沼泽潜伏者 | 瘟疫使者 |
| **冰原** | 冻结/减速/脆弱 | 冰霜巨人 | 雪原刺客 | 冰棱法师 |

---

## 3. 单位技能库

### 3.1 触发类型体系

| 触发类型 | 触发条件 | 示例 |
|----------|----------|------|
| **首次交战** | 进入战斗范围瞬间 | 突进斩、开场AOE |
| **周期性** | 每N秒自动释放 | 每5秒发射一波箭雨 |
| **生命阈值** | HP低于X%时 | 暴怒狂化、濒死护盾 |
| **攻击累积** | 每攻击N次后 | 第3次攻击附加暴击 |
| **受击累积** | 每受击N次后 | 叠加护盾，满后反弹 |
| **敌人数量** | 范围内敌人大于X | AOE清场技能 |
| **死亡触发** | 死亡时 | 分裂、自爆、复活 |
| **地形触发** | 站在特定地形上 | 水面治疗、熔岩灼烧周围 |
| **能量槽满** | 攻击/受击累积能量 | 终极技能释放 |

### 3.2 技能效果类型

| 效果类别 | 具体效果 |
|----------|----------|
| **伤害类** | 单体伤害、AOE、持续伤害、斩杀 |
| **控制类** | 眩晕、冻结、减速、击退、牵引 |
| **增益类** | 攻击力提升、攻速提升、移速提升、护盾 |
| **治疗类** | 单体治疗、AOE治疗、持续再生 |
| **特殊类** | 复活、分裂、自爆、传送、召唤 |

### 3.3 技能示例（水域单位）

| 单位 | 普通攻击 | 主动技能（触发条件） | 被动技能 |
|------|----------|---------------------|----------|
| **潮汐卫士** | 近战单次打击 | 首次交战：击退前方敌人1格 | 水之护体：在水面格上护甲+30% |
| **激流射手** | 远程单次射击 | 周期性（每4秒）：连射3发 | 流畅移动：在水面格上移速+20% |
| **海妖** | 无（纯辅助） | - | 海妖之歌：周围敌方单位移速-30% |

---

## 4. AI行为规则

### 4.1 索敌机制

| 参数 | 说明 | 示例值 |
|------|------|--------|
| **索敌范围** | 全地图扫描 | - |
| **索敌间隔** | 每次索敌的时间间隔 | 0.5秒 |
| **索敌方式** | 定时器循环触发 | 每0.5秒执行一次 |

```
启动定时器（每0.5秒）
    ↓
扫描全地图，找最近敌人
    ↓
根据锁定模式过滤目标
    ↓
更新锁定目标
    ↓
向目标移动 / 攻击
    ↓
（等待0.5秒后重复）
```

### 4.2 目标锁定模式

| 锁定模式 | 目标优先级 | 典型单位 |
|----------|------------|----------|
| **单位优先型** | 单位 → 防御塔 → 基地 | 大部分战斗单位 |
| **建筑优先型** | 防御塔 → 基地（无视单位） | 攻城巨人、投石车 |

### 4.3 战斗状态

| 状态 | 行为 |
|------|------|
| **移动中** | 向锁定的目标移动 |
| **攻击中** | 目标进入攻击范围，停止移动，开始攻击 |
| **无目标** | 向敌方基地移动 |

---

## 5. 飞行单位机制

### 5.1 飞行单位特点

飞行单位是特殊的单位类型，具有以下特性：

| 特性 | 说明 |
|------|------|
| **地形加成** | ❌ 不受地形属性加成影响 |
| **地形负面效果** | ❌ 免疫所有地形负面效果（灼烧/溺水/冻结/困住等） |
| **移动限制** | ✅ 可通过任何地块，包括虚空 |
| **虚空移动** | ✅ 可在虚空上方移动 |
| **地块消失** | ✅ 不会坠毁，继续在虚空上方移动 |
| **连通性判定** | ❌ 不参与连通性判定（与地面单位相同） |

> **设计意图**：飞行单位作为高机动性单位，免疫地形效果是其核心价值，但不参与连通性判定保持游戏机制的一致性。

### 5.2 飞行单位 vs 地面单位

| 特性 | 地面单位 | 飞行单位 |
|------|----------|----------|
| 地形加成 | 受影响 | 不受影响 |
| 地形特殊效果 | 受影响（溺水/灼烧/减速） | 不受影响 |
| 虚空坠毁 | 下方地块消失会坠毁 | 不会坠毁 |
| 移动阻挡 | 被建筑阻挡 | 无阻挡 |
| 连通性参与 | 不参与 | 不参与 |

### 5.3 飞行单位示例

| 单位 | 来源地形 | 特点 |
|------|----------|------|
| 风鹰 | 森林 | 高机动，切后排 |
| 烈焰凤凰 | 熔岩 | AOE灼烧 |
| 冰霜巨龙 | 冰原 | 冻结呼吸 |

---

## 待补充内容

- [ ] 27种单位的详细属性数值
- [ ] 每种单位的具体技能设计
- [ ] 地形亲和的详细相容关系表
- [ ] 平衡性测试数据

---

## 变更记录

| 日期 | 版本 | 变更内容 |
|------|------|----------|
| 2026-01-17 | v0.1 | 创建框架文档 |
| 2026-01-19 | v0.2 | 完成属性系统、单位分类、技能库、AI规则、飞行单位机制设计 |
| 2026-01-19 | v0.3 | **文档统一修改**：①元素词条更新为8种；②7档交互档位；③飞行单位免疫所有地形效果，不参与连通性判定 |
| 2026-01-19 | v0.4 | **补充召唤规模机制**：每次召唤可生成1-3个单位，部分单位以小组形式出现 |

---

*本文档为头脑风暴输出，待后续细化*
