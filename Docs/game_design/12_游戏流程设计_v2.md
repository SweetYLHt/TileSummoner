# TileSummoner 游戏流程设计

> **设计日期**: 2026-01-18
> **状态**: 设计草稿 v2.2
> **最后更新**: 2026-01-19

---

## 1. 整体架构

### 双层资源机制

```
大局（Roguelike爬塔进程）
│
├─ 玩家从第1层开始
├─ 通过分支路线选择前进
├─ 每层是一个独立小局（3-5分钟即时对战）
├─ 卡牌/地块/遗物跨小局累积
└─ 失败后游戏结束

小局（单场战斗）
│
├─ 地块战斗开始时重置
├─ 战斗中消耗的地块仅本场消失（大局保留）
├─ 战斗结束后获得奖励
└─ 返回节点界面
```

### 核心流程图

```
主菜单
   ↓
新游戏 → [选择角色] → 多轮三选一初始地块/卡牌 → 第1层节点界面
继续游戏
设置
退出
   ↓
┌─────────────────────────────────────────┐
│       节点界面（路线地图形式，循环）      │
│                                         │
│  [战斗] [商店] [休息] [升级] [精英] [?] [Boss]
│       ↓        ↓        ↓        ↓       │
│   战斗前    购买/   回血/   随机         │
│   确认界面   售卖    移除     事件        │
│       ↓        ↓        ↓       ↓       │
│   即时对战   返回    返回    返回         │
│   3-5分钟    节点    节点    节点         │
│       ↓                                   │
│   加时赛（3分钟后，双倍法力）              │
│       ↓                                   │
│   结算界面                                 │
│   胜利→奖励→下一层                         │
│   失败→游戏结束                            │
│                                         │
│  Act 1（1-15层）→ Act 2（16-30层）→ Act 3（31-45层）│
│                                         │
│   失败 → 游戏结束                        │
└─────────────────────────────────────────┘
```

---

## 2. 节点类型与功能

### 节点类型定义

| 节点类型 | 图标 | 功能 |
|---------|:----:|------|
| 战斗 | ⚔️ | 敌方情报预览，确认后开始战斗 |
| 商店 | 🛒 | 购买/售卖地块和卡牌 |
| 休息 | 🏕️ | 回复基地血量 / 升级卡牌 / 移除卡牌（三选一） |
| 升级 | ⬆️ | 三选一：升级一张卡牌 |
| 精英 | 👑 | 强力敌人，击败后获得稀有遗物 |
| ? | ❓ | 随机事件、宝箱、或未知遭遇 |
| Boss | 👹 | Boss战，胜利后获得遗物 |

### 节点界面布局（路线地图形式）

```
┌─────────────────────────────────────────────────┐
│  Act 1 - 第5层/15层    金币: 150                 │
├─────────────────────────────────────────────────┤
│                                                 │
│           [路线地图可视化]                       │
│                                                 │
│                    [Boss]                       │
│                       ↑                         │
│              ┌─────────┴─────────┐              │
│          [?]                    [战斗]           │
│            ↑                      ↑              │
│        [战斗] ← ─ ─ ─ ─ → [商店]               │
│            ↑                      ↑              │
│         [当前位置]            [休息]             │
│            ↓                      ↓              │
│        ┌───┴────┐           [战斗]              │
│       [?] [战斗]                                │
│        ↓    ↓                                   │
│    [起点] ...                                   │
│                                                 │
│  滚动查看完整地图，点击相邻节点前进               │
│                                                 │
├─────────────────────────────────────────────────┤
│  功能区                                         │
│    [查看卡组] [查看遗物] [+ 编辑地块配置]        │
└─────────────────────────────────────────────────┘
```

---

## 3. 地块编辑系统

### 地块编辑弹窗（点击按钮触发）

```
┌─────────────────────────────────────────────────┐
│              地块配置                             │
├─────────────────────────────────────────────────┤
│  棋盘地块（4×7）              库存地块            │
│  ┌───────────────┐         ┌───────────────┐    │
│  │ 草 草 水 沙 草 │   ↔    │ 草 水 沙 森 岩 │    │
│  │ 草 水 草 草 草 │         │ 农 熔 沼 冰    │    │
│  │ 草 草 草 沙 草 │         │ (商店购买补充)  │    │
│  │ ...28格...    │         │               │    │
│  └───────────────┘         └───────────────┘    │
│       拖拽互换                                 │
│                                                 │
│                   [确认] [取消]                 │
└─────────────────────────────────────────────────┘
```

### 编辑规则
- 所有节点类型都可以编辑地块（通用功能）
- 棋盘地块 ↔ 库存地块 可拖拽互换
- 拖拽后实时生效
- 战斗开始时从当前配置重置

---

## 4. 战斗前确认界面

### 敌方情报预览

```
┌─────────────────────────────────────────────────┐
│              即将进入战斗                         │
├─────────────────────────────────────────────────┤
│  敌方情报                                        │
│                                                 │
│  ┌───────────────┐                              │
│  │ 敌方地块分布   │   敌方情报:                  │
│  │ 熔 熔 草 草    │   • 单位: 火元素×3           │
│  │ 岩 熔 水 草    │           熔岩巨人×1          │
│  │ ... (4×7)     │   • 难度: ★★★☆☆            │
│  │               │   • 预计奖励: 稀有地块/卡牌  │
│  └───────────────┘                              │
│                                                 │
│  提示: 确认地块配置后再进入战斗                   │
│                                                 │
│  [确认进入战斗]          [返回调整地块]           │
└─────────────────────────────────────────────────┘
```

---

## 5. 战斗流程

### 战斗界面布局

```
┌─────────────────────────────────────────────────┐
│  法力: 7/10    时间: 02:15                       │
├─────────────────────────────────────────────────┤
│  敌方半区（镜像）                                 │
│  ┌─────────────────────────────────────────┐   │
│  │        [敌方基地]                        │   │
│  │      [塔]     [塔]                       │   │
│  │                                         │   │
│  │       敌方控制区（4×7）                   │   │
│  │     [敌方单位移动中...]                  │   │
│  └─────────────────────────────────────────┘   │
│  ───────────────── 中线 ─────────────────────   │
│  ┌─────────────────────────────────────────┐   │
│  │       我方控制区（4×7）                   │   │
│  │     [我方单位移动中...]                  │   │
│  │                                         │   │
│  │      [塔]     [塔]                       │   │
│  │        [我方基地]                        │   │
│  └─────────────────────────────────────────┘   │
├─────────────────────────────────────────────────┤
│  卡牌栏位（消耗品）      单位召唤操作区           │
│  ┌────┐ ┌────┐ ┌────┐   点击地块→选单位→选位置  │
│  │火球│ │冰冻│ │治疗│                            │
│  │×2  │ │×1  │ │×1  │                            │
│  └────┘ └────┘ └────┘                            │
└─────────────────────────────────────────────────┘
```

### 召唤单位三步流程

```
步骤1: 点击地块
  [草] [草] [水] [沙] [草]
              ↑ 点击水地块

步骤2: 弹出单位选择面板
  ┌─────────────────────────┐
  │  水地块可召唤：          │
  │  ┌─────────┐            │
  │  │水元素(前排)│ HP:100  │
  │  │攻击:15   │ 移动:2   │
  │  └─────────┘            │
  │  ┌─────────┐            │
  │  │海妖(辅助)│ HP:80    │
  │  │治疗:10/秒│          │
  │  └─────────┘            │
  │  ┌─────────┐            │
  │  │潮汐(功能)│ HP:60    │
  │  │减速光环  │          │
  │  └─────────┘            │
  └─────────────────────────┘

步骤3: 选择相邻正常地块放置单位（虚空不能放置）
  [?] [草] [?] [沙] [草]
   ↑   ↑   ↑ 高亮可选相邻位置
  水地块消失 → 单位诞生
```

**流程说明**：
- 点击地块后弹出该地块对应的3种单位选项
- 选择单位后，高亮显示相邻的可放置位置
- 相邻位置必须是正常地块（虚空不是地块，不能放置）
- 被点击的地块消失（变为虚空），单位诞生在选中的相邻地块上

### 战斗规则
- 法力值每秒+1，上限10点
- 卡牌是消耗品栏位，用完本场无法再使用
- 地块战斗开始时重置，消耗后本场消失
- 战斗中地块位置锁定，只能消耗召唤
- 可通过卡牌临时改变地块属性（战斗结束恢复）
- 单位自动索敌、自动攻击
- 断路判负
- **3分钟后进入加时赛（双倍法力回复）**

---

## 6. 战斗结算

### 胜利结算

```
┌─────────────────────────────────────────────────┐
│              🏆 战斗胜利！                        │
├─────────────────────────────────────────────────┤
│                                                 │
│  基础奖励:                                       │
│    金币 +50  [自动获得] ✓                        │
│                                                 │
│  选择额外奖励:                                   │
│  ┌─────────────┐  ┌─────────────┐              │
│  │ 🃏 卡牌奖励  │  │ 🟫 地块奖励  │              │
│  │ (三选一)     │  │ (三选一)     │              │
│  └─────────────┘  └─────────────┘              │
│                                                 │
│  ┌─────────────┐  ┌─────────────┐              │
│  │ 💰 金币+100  │  │ 🏺 遗物      │              │
│  │ (直接获得)   │  │ (直接获得)   │              │
│  └─────────────┘  └─────────────┘              │
│                                                 │
│  或跳过奖励 → [不选择，继续前进]                  │
└─────────────────────────────────────────────────┘
```

### 点击卡牌/地块奖励后

```
┌─────────────────────────────────────────────────┐
│              选择奖励 (三选一)                   │
├─────────────────────────────────────────────────┤
│  ┌─────────┐    ┌─────────┐    ┌─────────┐     │
│  │ 冰霜新星 │    │ 火球术   │    │ 治愈之光 │     │
│  │ 稀有     │    │ 普通     │    │ 稀有     │     │
│  │ 范围:3x3 │    │ 单体:30  │    │ 治疗:50  │     │
│  │ 冻结2秒  │    │ 消耗:3   │    │ 消耗:4   │     │
│  └─────────┘    └─────────┘    └─────────┘     │
│                                                 │
│  [返回]          [选择此奖励]                    │
└─────────────────────────────────────────────────┘
```

### 失败结算

```
┌─────────────────────────────────────────────────┐
│              💀 战斗失败                          │
├─────────────────────────────────────────────────┤
│                                                 │
│  你的征程到此结束...                             │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │  最终层数: 第5层                         │   │
│  │                                         │   │
│  │  本次游戏成就:                           │   │
│  │    ✓ 初露锋芒（到达第5层）               │   │
│  │    ✓ 战术大师（使用10张卡牌）            │   │
│  │    ✰ 未解锁: 勇者之心（到达第10层）      │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│              [返回主菜单]                        │
└─────────────────────────────────────────────────┘
```

---

## 7. 各节点详细功能

### 商店节点（含售卖功能）

```
┌─────────────────────────────────────────────────┐
│              🛒 商店                             │
├─────────────────────────────────────────────────┤
│  当前金币: 150                                   │
│                                                 │
│  [购买]                [售卖]                    │
│                                                 │
│  地块商店              你的库存                  │
│  ┌─────────┐          ┌─────────┐              │
│  │ 森林地块 │ 30金币    │ 沼泽地块 │ 15金币      │
│  │ 稀有     │           │ 稀有     │ [售卖]      │
│  └─────────┘          └─────────┘              │
│  ┌─────────┐          ┌─────────┐              │
│  │ 熔岩地块 │ 40金币    │ 沙地地块 │ 10金币      │
│  │ 稀有     │           │ 普通     │ [售卖]      │
│  └─────────┘          └─────────┘              │
│                       ...                       │
│                                                 │
│  卡牌商店              你的卡牌                  │
│  ┌─────────┐          ┌─────────┐              │
│  │ 冰霜新星 │ 50金币    │ 闪电术   │ 20金币      │
│  │ 稀有     │           │ 稀有     │ [售卖]      │
│  └─────────┘          └─────────┘              │
│                       ...                       │
│                                                 │
│  [刷新商店(50金币)]                              │
│  [离开商店]                                      │
└─────────────────────────────────────────────────┘
```

**售卖规则**：
- 售价约为购买价的 30-50%
- 稀有度越高，回收比例越高

### 休息节点

```
┌─────────────────────────────────────────────────┐
│              🔥 休息站                           │
├─────────────────────────────────────────────────┤
│  选择一项服务:                                   │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │  🔥 回复基地血量                         │   │
│  │     恢复基地30%最大生命值                 │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │  ❌ 移除地块                             │   │
│  │     从库存中永久移除一个地块             │   │
│  │     (优化地块构成，腾出库存空间)         │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │  ⬆️ 升级地块                             │   │
│  │     选择一个地块提升特性等级               │   │
│  │     基础→进阶→特殊                      │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  [跳过休息]          [确认选择]                 │
└─────────────────────────────────────────────────┘
```

### 升级节点

```
┌─────────────────────────────────────────────────┐
│              ⬆️ 升级台                           │
├─────────────────────────────────────────────────┤
│  选择要升级的地块:                               │
│                                                 │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐     │
│  │ 草地地块 │    │ 水域地块 │    │ 沙地地块 │     │
│  │ 基础    │    │ 基础    │    │ 基础    │     │
│  │ → 进阶   │    │ → 进阶   │    │ → 进阶   │     │
│  └─────────┘    └─────────┘    └─────────┘     │
│                                                 │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐     │
│  │ 森林地块 │    │ 岩石地块 │    │ 农田地块 │     │
│  │ 进阶    │    │ 进阶    │    │ 进阶    │     │
│  │ → 特殊   │    │ → 特殊   │    │ → 特殊   │     │
│  └─────────┘    └─────────┘    └─────────┘     │
│                                                 │
│              [免费升级一次]                      │
└─────────────────────────────────────────────────┘
```

---

## 8. 新游戏初始流程

### 步骤1：选择角色

```
┌─────────────────────────────────────────────────┐
│              新游戏 - 选择角色                   │
├─────────────────────────────────────────────────┤
│  选择你的角色:                                   │
│                                                 │
│  ┌─────────────────┐  ┌─────────────────┐     │
│  │  元素师艾琳     │  │  守卫官雷恩     │     │
│  │  [初始可用]     │  │  [需解锁]       │     │
│  │  元素连锁       │  │  阵地防御       │     │
│  │  初始: 水×8...  │  │  初始: 岩×8...  │     │
│  │  被动: 元素共鸣  │  │  被动: 坚守阵地  │     │
│  └─────────────────┘  └─────────────────┘     │
│                                                 │
│  ┌─────────────────┐                            │
│  │  游侠希尔       │                            │
│  │  [需解锁]       │                            │
│  │  机动突进       │                            │
│  │  初始: 森×10... │                            │
│  │  被动: 森林猎手  │                            │
│  └─────────────────┘                            │
│                                                 │
│              [确认选择]                          │
└─────────────────────────────────────────────────┘
```

### 步骤2：多轮三选一配置

```
┌─────────────────────────────────────────────────┐
│              新游戏 - 初始配置                   │
├─────────────────────────────────────────────────┤
│  选择初始地块 (1/5轮):                           │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐     │
│  │ 草地地块 │    │ 水域地块 │    │ 沙地地块 │     │
│  │ 基础     │    │ 基础     │    │ 基础     │     │
│  │ ━━━     │    │ ━━━     │    │ ━━━     │     │
│  │ 召唤:    │    │ 召唤:    │    │ 召唤:    │     │
│  │ 战士/弓手│    │ 水元素/  │    │ 流沙/   │     │
│  │         │    │ 海妖     │    │ 沙虫     │     │
│  └─────────┘    └─────────┘    └─────────┘     │
│                                                 │
│                    ↓ 下一轮 (2/5)              │
│                                                 │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐     │
│  │ 森林地块 │    │ 岩石地块 │    │ 农田地块 │     │
│  │ 进阶     │    │ 进阶     │    │ 进阶     │     │
│  │ ━━━━━   │    │ ━━━━━   │    │ ━━━━━   │     │
│  │ 召唤:    │    │ 召唤:    │    │ 召唤:    │     │
│  │ 精灵/   │    │ 山巨人/  │    │ 农夫/   │     │
│  │ 游侠     │    │ 投石车   │    │ 丰收祭司 │     │
│  └─────────┘    └─────────┘    └─────────┘     │
│                                                 │
│                    ↓ 继续选择...                │
│                                                 │
│  当前已选地块: [草] [水] [森] [岩] ...          │
│                                                 │
│              [确认并开始游戏]                   │
└─────────────────────────────────────────────────┘
```

**规则**：
- 进行5轮地块三选一
- 然后进行1-2轮卡牌三选一
- 玩家完全自由组合初始配置

---

## 9. 主菜单设计

```
┌─────────────────────────────────────────────────┐
│                                                 │
│            ███╗   ██╗███████╗██╗     ██╗         │
│            ████╗  ██║██╔════╝██║     ██║         │
│            ██╔██╗ ██║█████╗  ██║     ██║         │
│            ██║╚██╗██║██╔══╝  ██║     ██║         │
│            ██║ ╚████║███████╗███████╗███████╗   │
│            ╚═╝  ╚═══╝╚══════╝╚══════╝╚══════╝   │
│          地块召唤师 (TileSummoner)               │
│                                                 │
├─────────────────────────────────────────────────┤
│                                                 │
│              [ 新游戏 ]                          │
│                                                 │
│              [ 每日挑战 ]                        │
│                                                 │
│              [ 继续游戏 ]                        │
│                                                 │
│              [ 设置 ]                            │
│                                                 │
│              [ 退出 ]                            │
│                                                 │
└─────────────────────────────────────────────────┘
```

---

## 10. 核心设计总结

| 阶段 | 关键操作 | 约束 |
|------|----------|------|
| **新游戏** | 选择角色 → 多轮三选一地块/卡牌 | 自由组合初始配置 |
| **节点界面** | 路线地图 + 地块编辑弹窗 | 弹窗形式编辑地块 |
| **战斗前** | 敌方情报预览 | 可返回调整 |
| **战斗中** | 消耗地块召唤单位 | 地块本场消失，大局保留 |
| **加时赛** | 3分钟后双倍法力 | 加快战斗节奏 |
| **结算** | 金币直接获得 | 地块/卡牌三选一 |
| **失败** | 游戏结束 | 经典Roguelike |

---

## 11. 每日挑战流程

### 每日挑战入口

```
主菜单
│
├─ 新游戏
├─ [每日挑战] ← 新增入口
├─ 继续游戏
├─ 设置
└─ 退出
```

### 每日挑战界面

```
┌─────────────────────────────────────────────────┐
│              📅 每日挑战 - 2026-01-19            │
├─────────────────────────────────────────────────┤
│  今日规则:                                       │
│  ┌─────────────────────────────────────────┐   │
│  │  🌊 水系主宰                             │   │
│  │  • 所有水地块召唤单位生命+50%            │   │
│  │  • 其他地形单位生命-20%                 │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  排行榜（今日）:                                 │
│  ┌─────────────────────────────────────────┐   │
│  │  排名  玩家      层数  用时   基地血     │   │
│  │   1    XXX      45   18:32   85%       │   │
│  │   2    YYY      42   20:15   72%       │   │
│  │   3    ZZZ      38   22:40   100%      │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  注意: 每日挑战使用固定种子和固定初始配置         │
│                                                 │
│        [开始挑战]              [返回]            │
└─────────────────────────────────────────────────┘
```

### 每日挑战规则

| 组成部分 | 说明 |
|----------|------|
| **固定种子** | 地图节点、敌人配置、商店刷新、事件结果完全一致 |
| **固定初始配置** | 指定5轮地块三选一的结果，所有人起手相同 |
| **特殊规则** | 每日一个规则修饰符，改变游戏体验 |

> 详细规则列表见 [09_元游戏系统](./09_元游戏系统.md)

---

## 12. 待确认细节

- [ ] 每层具体有多少个分支路线节点
- [ ] ?随机节点的具体事件类型
- [ ] Boss层的触发条件（固定层数？）
- [ ] 遗物的获取条件和具体效果
- [ ] 元游戏进度（失败后是否保留永久解锁）
- [ ] 卡牌栏位的最大数量
- [ ] 地块库存的最大数量
- [ ] 每种地形具体的3种单位类型

---

## 13. 变更记录

| 版本 | 日期 | 变更内容 |
|------|------|----------|
| v2.0 | 2026-01-18 | 初始版本 |
| v2.1 | 2026-01-19 | 同步地形分类方式：普通/稀有/史诗 → 基础/进阶/特殊 |
| v2.2 | 2026-01-19 | 同步元游戏系统：添加角色选择界面、3Act结构、精英节点、每日挑战流程 |
| v2.3 | 2026-01-19 | **文档统一修改**：①召唤流程更新为三步；②明确相邻地块必须为正常地块（虚空不能放置） |

---

*本文档与 [02_核心机制](./02_核心机制.md)、[06_地形系统_完整](./06_地形系统_完整.md) 保持同步*
